<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css">
    <title>
      Factoriser
    </title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="/">
        <img src="/img/icon.ico" width="30" height="30" class="d-inline-block align-top" alt="">
        Gravitalia
      </a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="#">Factorise</a>
          </li>
        </ul>
      </div>
      <a href="/settings"><i style="color: white;" class="fas fa-cog"></i></a>
    </nav>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <br>
    <div align="center">
      <input type="text" id="f" class="form-control" style="max-width: 90%;" placeholder="45(x+6)" required>
      <br>
      <button type="button" class="btn btn-info" onclick="calc()">Factorise!</button>
    </div>
    <div id="res"></div>

    <script>
        function stringToCalc(fn) {
    return new Function('return ' + fn)();
}

function calc(anyCalc = null) {
    try {
        const calc      = anyCalc ?? document.getElementById("f").value;
        const regexUsed = calc.match(/[0-9|A-z]*|[+]*[()]/gm);
        const signe     = calc.match(/[+|-]/gm)[0];
        const number    = regexUsed[0];
        let toDo        = [];
        let finish      = "";
        let result;
        for(let i = 0; i < regexUsed.length; i++) {
            if(i !== 0 && regexUsed[i] !== ")" && regexUsed[i] !== "(" && regexUsed[i] !== "") {
                toDo.push(regexUsed[i])
            }
        }
        for(const n of toDo) {
            finish += `${number}*${n}${signe}`
        }
        finish = finish.split("")
        finish.pop()
        try {result = stringToCalc(finish.join(""))} catch (e) {
            const regex = /[A-z|0-9]*[*][[A-z|0-9]*/gm;
            let m;

            while ((m = regex.exec(finish.join(""))) !== null) {
                if (m.index === regex.lastIndex) {
                    regex.lastIndex++;
                }
                m.forEach((match, groupIndex) => {
                    try {
                        if(!result) result=stringToCalc(match)+signe; else result+=stringToCalc(match)+signe;
                    } catch(e) {
                        if(!result) result=match.replace("*", "")+signe; else result+=match.replace("*", "")+signe;
                    }
                });
            }
            result = result.split("")
            result.pop()
            result = result.join("")
        }
        document.getElementById("res").innerHTML = `<p>F = ${finish.join('')}<br>Resultat: ${result}</p>`
    } catch (e) {
        document.getElementById("res").innerHTML = `<p style="color: red;">Please check your calcul</p>`
    }
}
    </script>
  </body>
</html>